<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        YzzTing
    </title>
    
        <!-- 主css -->
        <link rel="stylesheet" href="/css/main.css">
        <!-- seo -->
        <meta name="description" content="翻译着 $watch How the $apply Runs a $digest

更新:这篇文章是给初学者而写的，适合对于像译者一样刚刚开始学习Angular，想知道如何实现数据绑定的同学。如果你已经可以熟练的掌握Angular，我强烈的建议你，通过源码进行分析。">
<meta property="og:type" content="article">
<meta property="og:title" content="译[$watch How the $apply Runs a $digest]">
<meta property="og:url" content="http://www.yzz1995.cn/2016/04/14/译[$watch How the $apply Runs a $digest]/index.html">
<meta property="og:site_name" content="YzzTing">
<meta property="og:description" content="翻译着 $watch How the $apply Runs a $digest

更新:这篇文章是给初学者而写的，适合对于像译者一样刚刚开始学习Angular，想知道如何实现数据绑定的同学。如果你已经可以熟练的掌握Angular，我强烈的建议你，通过源码进行分析。">
<meta property="og:updated_time" content="2016-04-14T16:53:26.574Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="译[$watch How the $apply Runs a $digest]">
<meta name="twitter:description" content="翻译着 $watch How the $apply Runs a $digest

更新:这篇文章是给初学者而写的，适合对于像译者一样刚刚开始学习Angular，想知道如何实现数据绑定的同学。如果你已经可以熟练的掌握Angular，我强烈的建议你，通过源码进行分析。">
            <!-- facicon -->
        
        <link rel="icon" href="http://7xp1k3.com1.z0.glb.clouddn.com/octocat-de-los-muertos.jpg">
                
        <!-- <link rel="stylesheet" href="/css/mian.css" type="text/css"> -->
        <script src="/js/toTop.js"></script>
        <!-- 统计 -->
        
    
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-75314797-1', 'auto');
          ga('send', 'pageview');
        </script>
    
</head>


	<body>
		<div class="mian">
			<header class="navHeader">
    <span class="logo-link"><a href="/" >Yzz</a></span>
        
                
        <ul class="nav nav-list">
            <li class="nav-list-item"><a href="/">home</a></li>
            
                
            
                
            <li class="nav-list-item"><a href="/about">about</a></li>
                
            
                
            <li class="nav-list-item"><a href="/tags">tags</a></li>
                
            
                
            <li class="nav-list-item"><a href="/archives">archives</a></li>
                
            
        </ul>
</header>

			<div class="con">
    <div class="blog-mian">
        <article class="article-main" itemscope itemprop="blogPost">
    <div class="articleCon">
        <header class="article-header">
            <h1 itemprop="name">
            <a href="/2016/04/14/译[$watch How the $apply Runs a $digest]/" class="article-title">译[$watch How the $apply Runs a $digest]</a>
        </h1>
        </header>
        <div class="article-meta">
            <a href="#" class="article-date">
    <time datetime="Apr 14 2016" itemprop="datePublished">
        Apr 14 2016
    </time>
</a>

        </div>
        <div class="article-inner">
            <div class="article-entry" itemprop="articleBody">
                <blockquote>
<p>翻译着 <a href="http://angular-tips.com/blog/2013/08/watch-how-the-apply-runs-a-digest/" target="_blank" rel="external">$watch How the $apply Runs a $digest</a></p>
</blockquote>
<p><strong>更新</strong>:这篇文章是给初学者而写的，适合对于像译者一样刚刚开始学习Angular，想知道如何实现数据绑定的同学。如果你已经可以熟练的掌握Angular，我强烈的建议你，通过源码进行分析。</p>
<a id="more"></a>
<p>Angular的使用者想知道如何进行数据绑定，有很多解决这个问题的方法:<code>$watch</code>,<code>$apply</code>,<code>$digest</code>,<code>drity-checking</code>…这些究竟是什么，它们又是如何工作的呢？这里我将解决所有的问题。其实在官方的文档中有了详细的说明，但是我还是想将他们结合在一起讲。但是我只是用了一种简单的方法来讲解，如果想要了解技术细节，请查看源码。</p>
<p>让我们从头开始</p>
<h2 id="u6D4F_u89C8_u5668_u4E8B_u4EF6_u548CAngular-js_u6269_u5C55"><a href="#u6D4F_u89C8_u5668_u4E8B_u4EF6_u548CAngular-js_u6269_u5C55" class="headerlink" title="浏览器事件和Angular.js扩展"></a>浏览器事件和Angular.js扩展</h2><p>我们的浏览器一直在等待事件。比如说用户交互。如果你点击了一个按钮或者输入了一段文字。事件回调就会在javascript的编译器中执行，然后你就可以进行DOM操作。因此，当回调事件完成时，浏览器将会在DOM上做出相应的改变。</p>
<p>Angular扩展在浏览器的循环上，创造了一个<code>angular context(angular上下文)</code>(记住它，它是一个重要的概念).要解释为什么是<code>context</code>以及它是如何工作的。我们需要解释更多的东西.</p>
<h2 id="24wathc__u961F_u5217"><a href="#24wathc__u961F_u5217" class="headerlink" title="$wathc 队列"></a>$wathc 队列</h2><p>每次你绑定一个UI时，就会将一个<code>$watch</code>添加到<code>$watch 队列</code>中。这里的<code>$watch</code>就是那个监视model有没有变化的东西。举个例子:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User: <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">ng-model</span>=<span class="value">"user"</span> /&gt;</span></span><br><span class="line">Password: <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">ng-model</span>=<span class="value">"pass"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>在这里，我们的<code>$scope.user</code>绑定在第一个输入框，<code>$scope.pass</code>绑定在第二个输入框。所以我们有两个<code>$watch</code>插入到<code>$watch 队列</code>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">'MainCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">  $scope.foo = <span class="string">"Foo"</span>;</span><br><span class="line">  $scope.world = <span class="string">"World"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello,&#123;&#123;world&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，尽管在<code>$scope</code>中挂载着2个东西，但是实际绑定在UI视图中，只有一个。所以只有一个<code>$watch</code>插入到<code>$watch 队列</code>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">'MainCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">  $scope.people = [...];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">li</span> <span class="attribute">ng-repeat</span>=<span class="value">"person in people"</span>&gt;</span></span><br><span class="line">      &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.age&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>有多少个<code>$watch</code>在上面的例子中被创造呢？每个person有一个(包括名字和年龄)再加上<code>ng-repeat</code>。如果有10个people，那么将会有<code>(2*10) + 1</code>,也就是21个</p>
<p>因此，每一个绑定在UI视图上的指令都会创造一个<code>$watch</code>。是的没错，但是这些<code>$watch</code>是在什么时候创造的呢？</p>
<p>当我们的模板被加载时，也就是说在<code>linking</code>阶段(关于angular的启动流程，请期待译者的下一篇文章),angular的编译器会寻找每个directive，并且创造所需要的<code>$watch</code>。听起来不错，但是，然后呢？</p>
<h2 id="digest__u5FAA_u73AF"><a href="#digest__u5FAA_u73AF" class="headerlink" title="digest 循环"></a>digest 循环</h2><p>还记得我说过的 <code>event-loop</code> 事件循环吗？当浏览器收到一个事件，该事件可以被<code>angular context</code>处理时，<code>$digest</code>循环就会触发。这个循环是由2个更小的循环拼起来的。一个用来处理<code>$evalAsync</code>,另一个用来处理<code>$watch</code>队列,也就是本文的主题。</p>
<p>那么，这是一个什么样的过程呢？<code>$digest</code>将会遍历<code>$watch</code>，然后询问:</p>
<ul>
<li>嘿，<code>$watch</code>,你的值是多少？<ul>
<li>9</li>
</ul>
</li>
<li>好吧！有没有改变过它？<ul>
<li>没有的</li>
</ul>
</li>
<li>(什么也没有发生与这一个，因此它移动到下一个<code>$watch</code>)</li>
<li>你的值是多少？</li>
<li>报告，是<code>Foo</code>.</li>
<li>刚才有没有改变过？</li>
<li>有的,一开始是<code>Bar</code>.<br>(好的，我们有DOM需要更新了)</li>
<li>就这样循环下去，知道每一个<code>$watch</code>都被检查过</li>
</ul>
<p>这就是<code>dirty-checking</code>。现在所有的<code>$watch</code>都被检查过了，那就要问:有没有<code>$watch</code>更新过？如果还有至少一个更新过，这个循环将会再一次触发。直到所有的<code>$watch</code>没有在更新。这样做可以保证所有的model不再有变化，但是如果循环超过10次。他将会无限循坏下去。</p>
<p>当这个<code>$digest 循环</code>完成时，DOM也会做出相应的改变</p>
<p>(简单的说，angular会给每一个<code>$scope</code>成员变量求出一个摘要值(能够唯一标识一个变量),并保存在一个变量中。当调用<code>$digest/$apply</code>方法时，会重新计算这个摘要值，要是数据变化了，他就会自动的更新界面——译者注)</p>
<h3 id="u672A_u5B8C_u5F85_u7EED"><a href="#u672A_u5B8C_u5F85_u7EED" class="headerlink" title="未完待续"></a>未完待续</h3>
            </div>
            
<nav id="article-nav">
  
  
    <a href="/2016/03/20/设计hexo主题/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title"> < 设计hexo主题</div>
    </a>
  
</nav>


        </div>
    </div>
    <div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//yzzting.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script id="dsq-count-scr" src="//yzzting.disqus.com/count.js" async></script>

</article>

    </div>
</div>

			

<div id="heart"></div>

    <footer class="blog-footer">
            <div id="footer-info" class="inner">
                &copy;
                2016
                    YzzTing Powered by
                        <a href="#" target="_blank">
                            Yzz
                        </a>
            </div>
    </footer>

		</div>
	</body>
	</html>
