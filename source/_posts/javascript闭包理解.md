title: javascript闭包理解
date: 2016-04-20 15:16:54
comments: true
tags:
    - javascript
---
## 今天我们聊一下闭包这个概念

首先，为什么会有闭包这个概念的呢？

在大多数的编程语言中，都会存在着一种垃圾回收机制。每当一个函数被执行后，通常都会期待函数的整个内部作用域都被销毁。因为引擎有垃圾回收器用来释放不再使用的内存空间，因为看上去这个函数的内容不会在被使用，所以很自然的会考虑对其进行回收

<!-- more -->

## 举个例子来看看

```js
function yzz() {
    var a = 2;

    function yzzting() {
        console.log( a );
    }

    return yzzting();
}

var ting = yzz();

ting(); // 2
```



函数yzzting()可以访问到yzz()的内部作用域，然后将yzzting()函数本身当作是一个值类型进行传递。在上面的例子中，我们将yzzting()所引用的函数对象本身当作是返回值。在yzz()执行后，其返回值(也就是yzzting()函数)赋值给变量ting并调用ting()，也就是说通过不同的标识符引用调用了内部的函数yzzting()。文章开头提到垃圾回收机制，而闭包的神奇之处就在这里，正是闭包阻止了回收。事实上内部的作用域依然是存在的，因此并没有被回收，那么是谁在使用这个作用域呢？

是yzzting()本身

拜yzzting()函数声明的位置所赐，它一出生就拥有了涵盖yzz()内部作用域的闭包，使用该作用域可以一直存活，以便在yzz()之后的任何时间进行引用

yzzting()函数依然拥有对该作用域的引用，而这个引用就是闭包

因此，在几微秒之后变量ting被实际调用(也就是调用内部函数yzzting()),所以他可以访问到定义时的词法作用域，所以可以访问到变量a

> 简单的说，词法作用域就是定义在词法阶段的作用域。换句话说，词法作用域是由你在写代码时将变量和块作用域写在哪里决定的

我们打个比喻，你买了一罐可口可乐，喝完了它，这个时候瓶子里是空的，你当然想扔了它。但是，你女朋友(其实是你的左右手)，往里面填入了一些土壤，还有几颗神奇的种子。不久后种子生根发芽，你可以拿着它做装饰。这个时候瓶子就一直存在了，并可以任你使用!

## 再来看个例子

```js
var a = 2;
(function yzzting() {
    console.log(a);
})();
```
这个例子讲真不能算是闭包，因为yzzting()并不是在它本身的词法作用域外执行的。它是在本身的定义时所在的作用域中执行的(而外部作用域，全局作用域也同时持有a)。这个a是通过普通的词法作用域查找，并不是闭包发现的。

最后总结一句

> 只要是使用了回调函数，就是使用了闭包

## End...
