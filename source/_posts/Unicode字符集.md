---
title: â€œğŸ’©â€.length === 2
date: 2017-03-11 14:27:21
layout: post
comments: true
tags:
    - javascript
    - Unicode
---

## â€œğŸ’©â€.length === 2

[åŸæ–‡åœ°å€](http://blog.jonnew.com/posts/poo-dot-length-equals-two)

ä¸€ç¯‡æœ‰è¶£çš„æ–‡ç« ,å…³äºUnicodeå­—ç¬¦é›†

å¯¹çš„,åœ¨javaScriptä¸­ â€œğŸ’©â€.length === 2.ä½ å¯ä»¥åœ¨Chromeè°ƒè¯•æ§åˆ¶å°ä¸­æˆ–è€…Node.JS REPLä¸­è‡ªå·±è¯•è¯•çœ‹.ä½†æ˜¯åˆä¸ºä»€ä¹ˆâ€™â›³â€™.length === 1?

è¿™ä¸€åˆ‡éƒ½å½’ç»“äºç ç‚¹è¿˜æœ‰Unicodeå­—ç¬¦é›†.å¦‚æœä½ å¯¹Unicodeå­—ç¬¦é›†æœ‰ç‚¹é™Œç”Ÿ,å¯ä»¥å…ˆæˆ³è¿™é‡Œ (åˆæ˜¯è‹±æ–‡çš„ä¸çœ‹ ^-^)

<!-- more -->

æ¥ä¸‹æ¥å‡ ä¸ªæ®µè½æ˜¯[javaScript Unicode](https://mathiasbynens.be/notes/javascript-unicode)è¿™ç¯‡æ–‡ç« çš„æ‘˜è¦,è™½ç„¶æ˜¯5å¹´å‰çš„æ–‡ç« .

Unicodeæ˜¯ç›®å‰ç»å¤§å¤šæ•°ç¨‹åºä½¿ç”¨çš„å­—ç¬¦ç¼–ç ,å®šä¹‰ä¹Ÿå¾ˆç®€å•,ç”¨ä¸€ä¸ªç ç‚¹(code point)æ˜ å°„ä¸€ä¸ªå­—ç¬¦.ç ç‚¹å€¼çš„èŒƒå›´æ˜¯ä»U+0000åˆ°U+10FFFF,å¯ä»¥è¡¨ç¤ºè¶…è¿‡110ä¸‡ä¸ªç¬¦å·.Unicodeæœ€å‰é¢çš„65536ä¸ªå­—ç¬¦ä½,ç§°ä¸ºåŸºæœ¬å¹³é¢ï¼ˆBMP-â€”Basic Multilingual Planeï¼‰,å®ƒçš„ç ç‚¹èŒƒå›´æ˜¯ä»U+0000åˆ°U+FFFF.æœ€å¸¸è§çš„å­—ç¬¦éƒ½æ”¾åœ¨è¿™ä¸ªå¹³é¢,è¿™æ˜¯Unicodeæœ€å…ˆå®šä¹‰å’Œå…¬å¸ƒçš„ä¸€ä¸ªå¹³é¢.

å‰©ä¸‹çš„å­—ç¬¦éƒ½æ”¾åœ¨è¡¥å……å¹³é¢ï¼ˆSupplementary Planeï¼‰,ç ç‚¹èŒƒå›´ä»U+010000ä¸€ç›´åˆ°U+10FFFF,å…±16ä¸ª.

æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼è¡¨ç¤ºå­—ç¬¦, â€œAâ€ === â€œ\u0041â€ === â€œ\x41â€ === â€œ\u{41}â€ .è¿™äº›æ˜¯è½¬ä¹‰åºåˆ—. \xå¯ä»¥ç”¨äºå¤§å¤šæ•°ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰åŸºæœ¬å¤šè¯­è¨€å¹³é¢,å…·ä½“ä¸ºU+0000 ã€œ U+00FF. \uå¯ç”¨äºä»»ä½•Unicodeå­—ç¬¦,å¦‚æœæœ‰å¤šäº4ä¸ªåå…­è¿›åˆ¶æ•°å­—,åˆ™éœ€è¦èŠ±æ‹¬å·,å¦åˆ™ä¸ºå¯é€‰.å½“ç„¶è¿™åªæ˜¯javaScript/HTMLçš„è§„åˆ™,å…¶ä»–è¯­è¨€æœ‰è‡ªå·±çš„è§„åˆ™.

å¯ä»¥åœ¨[codepoints.net](https://codepoints.net/U+1F4A9)æŸ¥åˆ°ğŸ’©çš„ç ç‚¹ â€œğŸ’©â€ === â€œ\u{1F4A9}â€ä¸å¹¸çš„æ˜¯,â€ğŸ’©â€ === â€œ\uD83D\uDCA9â€.æ‰€æœ‰ç ç‚¹éƒ½å¯ä»¥ç”¨ä»£ç†å¯¹æ¥è¡¨ç¤º,è¿™æ˜¯ä¸ºäº†å‘åå…¼å®¹.è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰ä¸€ä¸ªå…¬å¼æ¥è®¡ç®—ç ç‚¹å¯¹åº”çš„ä»£ç†å¯¹,åä¹‹äº¦ç„¶.

ç»™å®šå¤§äº0xFFFFçš„ç ç‚¹C,å®ƒå¯¹åº”äºä»£ç†å¯¹.

```js
H = Math.floor((C - 0x10000) / 0x400) + 0xD800
L = (C - 0x10000) % 0x400 + 0xDC00
```
å› æ­¤,æˆ‘ä»¬å¯ä»¥å¾—åˆ°:

```js
C = 0x1F4A9
H = (Math.floor((0x1F4A9 - 0x10000) / 0x400) + 0xD800).toSring(16) = 0xD83D
L = ((0x1F4A9 - 0x10000) % 0x400 + 0xDC00).toString(16)
```

toString(16)å°†å­—ç¬¦è½¬ä¸º16è¿›åˆ¶,æœ€ç»ˆå¾—åˆ°çš„ç­”æ¡ˆå¯¹åº”äºä¸Šé¢çš„\uD83D\uDCA9

æˆ‘æ³¨æ„åˆ°è¡¨æƒ…ç¬¦å·è¢«è®¡ä¸ºå¤šä¸ª.äº‹å®ä¸Š,å¦‚æœæ‚¨åœ¨å¯†ç å­—æ®µä¸­ç²˜è´´ğŸ’©,æ‚¨ä¼šçœ‹åˆ°:

å¦å¤–è¿™é‡Œæœ‰ä¸€ç¯‡è®¨è®ºè¡¨æƒ…ç¬¦å·å¯†ç å¥½å¤„çš„[æ–‡ç« ](https://medium.com/@hvost/why-you-should-not-use-emojis-in-your-passwords-b8db0607e169#.ee3f1qr43)

é‚£ä¹ˆåˆ°åº•æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥æ­£ç¡®çš„è®¡æ•°å‘¢?[Bynens](https://mathiasbynens.be/notes/javascript-unicode#accounting-for-astral-symbols)åˆ—å‡ºäº†å‡ ç§æ–¹æ³•,ES6ä¸­çš„Array.fromä¹Ÿæœ‰å‡ ç§æ–¹å¼æ”¯æŒå¯¹ä»£ç†å¯¹çš„è§£æ,ä¸è¿‡è¯·ä¸è¦åœ¨IE11ä»¥ä¸‹å°è¯•!!

```js
Array.from("ğŸ’©").length === 1; //hooray!
```

however

```js
Array.from("â¤ï¸").length === 2; //boooo!
```

![](http://blog.jonnew.com/assets/poo-unicode/why1.jpg)

ä»æˆ‘çš„ç†è§£â¤ï¸åŒ…æ‹¬ä¸¤ä¸ªç ç‚¹:U+2764å’ŒU+FE0F.é¦–å…ˆæ˜¯é»‘æ¡ƒ ç„¶åæ˜¯Variation Selector 16æ”¹å˜å‰ä¸€ä¸ªå­—ç¬¦çš„å¤–è§‚,äº‹å®ä¸Š,U+FE00åˆ°U+FE0Féƒ½å¯ä»¥æ”¹å˜å‰ä¸€ä¸ªå­—ç¬¦çš„å¤–è§‚.å¯¹äºè¿™ä¸ªå¿ƒçš„æƒ…å†µ,åªæœ‰U+ FE0F.å…¶ä»–å¿ƒï¼ˆğŸ’™,ğŸ’š,ğŸ’›,ğŸ’œï¼‰æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ç ç‚¹,ä½†çº¢è‰²çš„å¿ƒéœ€è¦ä¸¤ä¸ª.æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆ,æ‰€ä»¥æˆ‘é—®Stack Overflow.

ä¸ºäº†é€‚åº”è¿™ä¸ª,æˆ‘å¿…éœ€æ”¹å˜æˆ‘çš„ä»£ç :

```js
function fancyCount(str){
  return Array.from(str.split(/[\ufe00-\ufe0f]/).join("")).length;
}
```
ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼In .split(/[\ufe00-\ufe0f]/).join("")æ’é™¤äº†å˜åŒ–é€‰æ‹©å™¨(variation selectors è¿™æ ·ç¿»?

```js
fancyCount("ğŸ’©") === 1 //hooray!
fancyCount("â¤ï¸") === 1 //hooray!
```

å› æ­¤æˆ‘ä»¬æˆåŠŸäº†ä¹ˆ?ä¸,è¿™ç¯‡æ–‡ç« æˆ‘å†™å¾—è¶Šå¤š,æ¼æ´å°±è¶Šå¤š.æˆ‘æŠŠæŠŠå¥³äºº,å¿ƒ,å»,å¦‡å¥³emojisæ”¾åœ¨ä¸€èµ·ç»å¸¸ä½œä¸ºä¸€ä¸ªå•ä¸€çš„è¡¨æƒ…ç¬¦å·.

```js
"ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©".length === 11
Array.from("ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©").length === 8
fancyCount("ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©") === 7
```

![](http://blog.jonnew.com/assets/poo-unicode/makeitstop.gif)

ğŸ‘©â¤ï¸ğŸ’‹ğŸ‘©æ˜¯é€šè¿‡åœ¨ç»„ä»¶emojisä¹‹é—´æœ‰ä¸€ä¸ªé›¶å®½åº¦Joiner \u{200D} å­—ç¬¦åˆ›å»ºçš„.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```js
function fancyCount2(str){
  const joiner = "\u{200D}";
  const split = str.split(joiner);
  let count = 0;
  for(const s of split){
    //removing the variation selectors
    const num = Array.from(s.split(/[\ufe00-\ufe0f]/).join("")).length;
    count += num;
  }
  //assuming the joiners are used appropriately
  return count / split.length;
}
```
so

```js
fancyCount2("ğŸ’©") === 1 //hooray!
fancyCount2("â¤ï¸") === 1 //hooray!
fancyCount2("ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©") === 1 //hooray!
```
è€å®è¯´,ä½ æœ€å¥½æ°¸è¿œéƒ½ä¸è¦è¿™æ ·ä½¿ç”¨,å¹¶ä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨,UIç­‰,å°†ğŸ‘©â¤ï¸ğŸ’‹ğŸ‘©æ¸²æŸ“ä¸ºä¸€ä¸ªå•ä¸€çš„ç¬¦å·.å¦‚æœä½ æœ‰æ›´å¥½çš„è®¡æ•°æ–¹æ³•è¯·å‘Šè¯‰æˆ‘!

ç¿»è¯‘çš„æ—¶å€™æœ‰æ‰€åˆ å‡

æ–‡ç« æ•´ä½“æ€è·¯

* å…ˆæ‰¾å‡ºemojisçš„ç ç‚¹
* é€šè¿‡å…¬å¼è®¡ç®—ä»£ç†å¯¹
* åˆ©ç”¨æ­£åˆ™æ’é™¤å˜åŒ–é€‰æ‹©å™¨,ç®—å‡ºå­—èŠ‚é•¿åº¦

å‚è€ƒèµ„æ–™

[Unicodeä¸JavaScriptè¯¦è§£](http://www.ruanyifeng.com/blog/2014/12/unicode.html)

[JavaScript has a Unicode problem](https://mathiasbynens.be/notes/javascript-unicode)